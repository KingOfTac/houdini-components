import t from"crypto";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function n(t,n,e,r){return new(e||(e=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,u)}c((r=r.apply(t,n||[])).next())}))}var e,r,i,o;!function(t){t.block="block",t.normal="normal"}(e||(e={})),function(t){t.blockLike="block-like",t.manual="manual"}(r||(r={})),function(t){t.none="none",t.page="page",t.column="column",t.region="region"}(i||(i={})),function(t){t.none="none",t.line="line",t.page="page",t.column="column",t.region="region"}(o||(o={}));class s{}class u{}class c{layout(t,e,r,i){return n(this,void 0,void 0,(function*(){return new s}))}intrinsicSizes(t,e,r){return n(this,void 0,void 0,(function*(){return new u}))}}var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function h(t,n){return t(n={exports:{}},n.exports),n.exports}var f=h((function(t){!function(t,n,e){function r(t){var n,e=this,r=(n=4022871197,function(t){t=String(t);for(var e=0;e<t.length;e++){var r=.02519603282416938*(n+=t.charCodeAt(e));r-=n=r>>>0,n=(r*=n)>>>0,n+=4294967296*(r-=n)}return 2.3283064365386963e-10*(n>>>0)});e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=r(" "),e.s1=r(" "),e.s2=r(" "),e.s0-=r(t),e.s0<0&&(e.s0+=1),e.s1-=r(t),e.s1<0&&(e.s1+=1),e.s2-=r(t),e.s2<0&&(e.s2+=1),r=null}function i(t,n){return n.c=t.c,n.s0=t.s0,n.s1=t.s1,n.s2=t.s2,n}function o(t,n){var e=new r(t),o=n&&n.state,s=e.next;return s.int32=function(){return 4294967296*e.next()|0},s.double=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.quick=s,o&&("object"==typeof o&&i(o,e),s.state=function(){return i(e,{})}),s}n&&n.exports?n.exports=o:e&&e.amd?e((function(){return o})):this.alea=o}(0,t,!1)})),l=h((function(t){!function(t,n,e){function r(t){var n=this,e="";n.x=0,n.y=0,n.z=0,n.w=0,n.next=function(){var t=n.x^n.x<<11;return n.x=n.y,n.y=n.z,n.z=n.w,n.w^=n.w>>>19^t^t>>>8},t===(0|t)?n.x=t:e+=t;for(var r=0;r<e.length+64;r++)n.x^=0|e.charCodeAt(r),n.next()}function i(t,n){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n}function o(t,n){var e=new r(t),o=n&&n.state,s=function(){return(e.next()>>>0)/4294967296};return s.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=e.next,s.quick=s,o&&("object"==typeof o&&i(o,e),s.state=function(){return i(e,{})}),s}n&&n.exports?n.exports=o:e&&e.amd?e((function(){return o})):this.xor128=o}(0,t,!1)})),d=h((function(t){!function(t,n,e){function r(t){var n=this,e="";n.next=function(){var t=n.x^n.x>>>2;return n.x=n.y,n.y=n.z,n.z=n.w,n.w=n.v,(n.d=n.d+362437|0)+(n.v=n.v^n.v<<4^t^t<<1)|0},n.x=0,n.y=0,n.z=0,n.w=0,n.v=0,t===(0|t)?n.x=t:e+=t;for(var r=0;r<e.length+64;r++)n.x^=0|e.charCodeAt(r),r==e.length&&(n.d=n.x<<10^n.x>>>4),n.next()}function i(t,n){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n.v=t.v,n.d=t.d,n}function o(t,n){var e=new r(t),o=n&&n.state,s=function(){return(e.next()>>>0)/4294967296};return s.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=e.next,s.quick=s,o&&("object"==typeof o&&i(o,e),s.state=function(){return i(e,{})}),s}n&&n.exports?n.exports=o:e&&e.amd?e((function(){return o})):this.xorwow=o}(0,t,!1)})),x=h((function(t){!function(t,n,e){function r(t){var n=this;n.next=function(){var t,e,r=n.x,i=n.i;return t=r[i],e=(t^=t>>>7)^t<<24,e^=(t=r[i+1&7])^t>>>10,e^=(t=r[i+3&7])^t>>>3,e^=(t=r[i+4&7])^t<<7,t=r[i+7&7],e^=(t^=t<<13)^t<<9,r[i]=e,n.i=i+1&7,e},function(t,n){var e,r=[];if(n===(0|n))r[0]=n;else for(n=""+n,e=0;e<n.length;++e)r[7&e]=r[7&e]<<15^n.charCodeAt(e)+r[e+1&7]<<13;for(;r.length<8;)r.push(0);for(e=0;e<8&&0===r[e];++e);for(8==e&&(r[7]=-1),t.x=r,t.i=0,e=256;e>0;--e)t.next()}(n,t)}function i(t,n){return n.x=t.x.slice(),n.i=t.i,n}function o(t,n){null==t&&(t=+new Date);var e=new r(t),o=n&&n.state,s=function(){return(e.next()>>>0)/4294967296};return s.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=e.next,s.quick=s,o&&(o.x&&i(o,e),s.state=function(){return i(e,{})}),s}n&&n.exports?n.exports=o:e&&e.amd?e((function(){return o})):this.xorshift7=o}(0,t,!1)})),p=h((function(t){!function(t,n,e){function r(t){var n=this;n.next=function(){var t,e,r=n.w,i=n.X,o=n.i;return n.w=r=r+1640531527|0,e=i[o+34&127],t=i[o=o+1&127],e^=e<<13,t^=t<<17,e^=e>>>15,t^=t>>>12,e=i[o]=e^t,n.i=o,e+(r^r>>>16)|0},function(t,n){var e,r,i,o,s,u=[],c=128;for(n===(0|n)?(r=n,n=null):(n+="\0",r=0,c=Math.max(c,n.length)),i=0,o=-32;o<c;++o)n&&(r^=n.charCodeAt((o+32)%n.length)),0===o&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(s=s+1640531527|0,i=0==(e=u[127&o]^=r+s)?i+1:0);for(i>=128&&(u[127&(n&&n.length||0)]=-1),i=127,o=512;o>0;--o)r=u[i+34&127],e=u[i=i+1&127],r^=r<<13,e^=e<<17,r^=r>>>15,e^=e>>>12,u[i]=r^e;t.w=s,t.X=u,t.i=i}(n,t)}function i(t,n){return n.i=t.i,n.w=t.w,n.X=t.X.slice(),n}function o(t,n){null==t&&(t=+new Date);var e=new r(t),o=n&&n.state,s=function(){return(e.next()>>>0)/4294967296};return s.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=e.next,s.quick=s,o&&(o.X&&i(o,e),s.state=function(){return i(e,{})}),s}n&&n.exports?n.exports=o:e&&e.amd?e((function(){return o})):this.xor4096=o}(0,t,!1)})),g=h((function(t){!function(t,n,e){function r(t){var n=this,e="";n.next=function(){var t=n.b,e=n.c,r=n.d,i=n.a;return t=t<<25^t>>>7^e,e=e-r|0,r=r<<24^r>>>8^i,i=i-t|0,n.b=t=t<<20^t>>>12^e,n.c=e=e-r|0,n.d=r<<16^e>>>16^i,n.a=i-t|0},n.a=0,n.b=0,n.c=-1640531527,n.d=1367130551,t===Math.floor(t)?(n.a=t/4294967296|0,n.b=0|t):e+=t;for(var r=0;r<e.length+20;r++)n.b^=0|e.charCodeAt(r),n.next()}function i(t,n){return n.a=t.a,n.b=t.b,n.c=t.c,n.d=t.d,n}function o(t,n){var e=new r(t),o=n&&n.state,s=function(){return(e.next()>>>0)/4294967296};return s.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=e.next,s.quick=s,o&&("object"==typeof o&&i(o,e),s.state=function(){return i(e,{})}),s}n&&n.exports?n.exports=o:e&&e.amd?e((function(){return o})):this.tychei=o}(0,t,!1)})),v=h((function(n){!function(e,r,i){var o,s=i.pow(256,6),u=i.pow(2,52),c=2*u;function a(t,n,a){var x=[],p=l(function t(n,e){var r,i=[],o=typeof n;if(e&&"object"==o)for(r in n)try{i.push(t(n[r],e-1))}catch(t){}return i.length?i:"string"==o?n:n+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[t,d(r)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(256):(t=new Uint8Array(256),(e.crypto||e.msCrypto).getRandomValues(t)),d(t)}catch(t){var n=e.navigator,i=n&&n.plugins;return[+new Date,e,i,e.screen,d(r)]}}():t,3),x),g=new h(x),v=function(){for(var t=g.g(6),n=s,e=0;t<u;)t=256*(t+e),n*=256,e=g.g(1);for(;t>=c;)t/=2,n/=2,e>>>=1;return(t+e)/n};return v.int32=function(){return 0|g.g(4)},v.quick=function(){return g.g(4)/4294967296},v.double=v,l(d(g.S),r),(n.pass||a||function(t,n,e,r){return r&&(r.S&&f(r,g),t.state=function(){return f(g,{})}),e?(i.random=t,n):t})(v,p,"global"in n?n.global:this==i,n.state)}function h(t){var n,e=t.length,r=this,i=0,o=r.i=r.j=0,s=r.S=[];for(e||(t=[e++]);i<256;)s[i]=i++;for(i=0;i<256;i++)s[i]=s[o=255&o+t[i%e]+(n=s[i])],s[o]=n;(r.g=function(t){for(var n,e=0,i=r.i,o=r.j,s=r.S;t--;)n=s[i=255&i+1],e=256*e+s[255&(s[i]=s[o=255&o+n])+(s[o]=n)];return r.i=i,r.j=o,e})(256)}function f(t,n){return n.i=t.i,n.j=t.j,n.S=t.S.slice(),n}function l(t,n){for(var e,r=t+"",i=0;i<r.length;)n[255&i]=255&(e^=19*n[255&i])+r.charCodeAt(i++);return d(n)}function d(t){return String.fromCharCode.apply(0,t)}if(l(i.random(),r),n.exports){n.exports=a;try{o=t}catch(t){}}else i.seedrandom=a}("undefined"!=typeof self?self:a,[],Math)}));v.alea=f,v.xor128=l,v.xorwow=d,v.xorshift7=x,v.xor4096=p,v.tychei=g;let b=v();function w(t,n,e){const r=Array.isArray(arguments[0]);if(r){const t=arguments[0];return t[w(0,t.length-1,!0)]}{const t=arguments[0],n=arguments[1],e=arguments[2]||!1,r=b()*(n-t)+t;return e?Math.round(r):r}}function y(t,n,e,r=.5){const i=w(t,n),o=w(0,1)*r;return i*(1-o)+e*o}class m{constructor(t,n=10,e=4,r=0){this.bounds=t,this.maxObjects=n,this.maxLevels=e,this.level=r,this.objects=[],this.nodes=[]}split(){const t=this.level+1,n=this.bounds.width/2,e=this.bounds.height/2,r=this.bounds.x,i=this.bounds.y;this.nodes[0]=new m({x:r+n,y:i,width:n,height:e},this.maxObjects,this.maxLevels,t),this.nodes[1]=new m({x:r,y:i,width:n,height:e},this.maxObjects,this.maxLevels,t),this.nodes[2]=new m({x:r,y:i+e,width:n,height:e},this.maxObjects,this.maxLevels,t),this.nodes[3]=new m({x:r+n,y:i+e,width:n,height:e},this.maxObjects,this.maxLevels,t)}getIndex(t){const n=this.bounds,e=[],r=n.x+n.width/2,i=n.y+n.height/2,o=t.y<i,s=t.x<r,u=t.x+t.width>r,c=t.y+t.height>i;return o&&u&&e.push(0),s&&o&&e.push(1),s&&c&&e.push(2),u&&c&&e.push(3),e}insert(t){let n;if(this.nodes.length){n=this.getIndex(t);for(let e=0;e<n.length;e++)this.nodes[n[e]].insert(t)}else if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels){this.nodes.length||this.split();for(let t=0;t<this.objects.length;t++){n=this.getIndex(this.objects[t]);for(let e=0;e<n.length;e++)this.nodes[n[e]].insert(this.objects[t])}this.objects=[]}}retrieve(t){const n=this.getIndex(t);let e=this.objects;if(this.nodes.length)for(let r=0;r<n.length;r++)e=e.concat(this.nodes[n[r]].retrieve(t));return e=e.filter((t,n)=>e.indexOf(t)>=n),e}clear(){this.objects=[];for(let t=0;t<this.nodes.length;t++)this.nodes.length&&this.nodes[t].clear();this.nodes=[]}}const j=function(t,n){return n.map(n=>{switch(n.variable=`--${t}-${n.name}`,n.type){case"number":n.value=t=>parseInt(t);break;case"string":n.value=t=>t.toString().trim();break;case"boolean":case"object":n.value=t=>JSON.parse(t)}}),Object.defineProperties({},{propsMap:{value:n},values:{get:function(){const t=[];return this.propsMap.forEach(n=>t.push(n.value)),t}},variableStrings:{get:function(){const t=[];return this.propsMap.forEach(n=>t.push(n.variable)),t}}})}("qt",[{name:"points",type:"number",default:100},{name:"gap",type:"number",default:5},{name:"maxObjects",type:"number",default:10},{name:"maxLevels",type:"number",default:4}]);function S(t){const n=[];return function t(e){0===e.nodes.length?n.push(e):e.nodes.forEach(n=>t(n))}(t),n}const z=new Map;let k=class{static get inputProperties(){return j.variableStrings}static get childInputProperties(){return[]}intrinsicSizes(t,e,r){return n(this,void 0,void 0,(function*(){const n=yield Promise.all(t.map(t=>t.intrinsicSizes())),r=n.reduce((t,n)=>t+n.maxContentSize,0)+e.inline;return{minContentSize:n.reduce((t,n)=>t+n.minContentSize,0)+e.inline,maxContentSize:r}}))}layout(t,e,r,i,o){return n(this,void 0,void 0,(function*(){const n={};j.propsMap.forEach(t=>n[t.name]=t.value(i.get(t.variable))|t.default),console.log(n);const o=r.fixedInlineSize-e.inline,s=r.fixedBlockSize?r.fixedBlockSize-e.block:o,u=function(t){let n=0;if(Object.values(t).forEach(t=>n+=function(t){let n=0;if(0==t.length)return n;for(let e=0;e<t.length;e++){n=(n<<5)-n+t.charCodeAt(e),n&=n}return n}(t.toString())),z.has(n))return console.log(z.get(n),"cache"),z.get(n);{const e={x:w(0,t.width),y:w(0,t.height)},r=[...Array(t.points)].map(()=>({x:y(0,t.width,e.x,1),y:y(0,t.height,e.y,1),width:1,height:1})),i=new m({x:0,y:0,width:t.width,height:t.height},t.maxObjects,t.maxLevels);return r.forEach(t=>i.insert(t)),z.set(n,i),console.log(i,"first"),i}}({width:o,height:s,maxObjects:n.maxObjects,maxLevels:n.maxLevels,points:n.points}),c=Math.pow(2,n.maxLevels),a=o/c,h=s/c,f={width:o,height:s,cols:c,rows:c,areas:S(u).map(({bounds:t})=>Object.assign({x:t.x+n.gap,y:t.y+n.gap,width:t.width-n.gap,height:t.height-n.gap},function(t,n,e){return{col:{start:t.x/n,end:(t.x+t.width)/n},row:{start:t.y/e,end:(t.y+t.height)/e}}}(t,a,h)))},l=yield Promise.all(t.map((t,n)=>t.layoutNextFragment({fixedInlineSize:f.areas[n].width,fixedBlockSize:f.areas[n].height})));for(let t of l){const n=l.indexOf(t),e=f.areas[n];t.inlineOffset=e.x,t.blockOffset=e.y}return{autoBlockSize:0,childFragments:l}}))}};var O;k.LayoutOptions={childDisplay:e.normal,sizing:r.blockLike},k=function(t,n,e,r){var i,o=arguments.length,s=o<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,e):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,n,e,r);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(s=(o<3?i(s):o>3?i(n,e,s):i(n,e))||s);return o>3&&s&&Object.defineProperty(n,e,s),s}([(O="quadtree",function(t){t.prototype.layout&&t.prototype.intrinsicSizes||(t=c),registerLayout(O,t)})],k);export{k as QuadtreeLayout};
