/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function t(t,n,e,i){return new(e||(e=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function u(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,u)}c((i=i.apply(t,n||[])).next())}))}var n,e,i,r;!function(t){t.block="block",t.normal="normal"}(n||(n={})),function(t){t.blockLike="block-like",t.manual="manual"}(e||(e={})),function(t){t.none="none",t.page="page",t.column="column",t.region="region"}(i||(i={})),function(t){t.none="none",t.line="line",t.page="page",t.column="column",t.region="region"}(r||(r={}));class o{}class s{}class u{layout(n,e,i,r){return t(this,void 0,void 0,(function*(){return new o}))}intrinsicSizes(n,e,i){return t(this,void 0,void 0,(function*(){return new s}))}}var c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function a(t,n){return t(n={exports:{}},n.exports),n.exports}var h=a((function(t){!function(t,n,e){function i(t){var n,e=this,i=(n=4022871197,function(t){t=String(t);for(var e=0;e<t.length;e++){var i=.02519603282416938*(n+=t.charCodeAt(e));i-=n=i>>>0,n=(i*=n)>>>0,n+=4294967296*(i-=n)}return 2.3283064365386963e-10*(n>>>0)});e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=i(" "),e.s1=i(" "),e.s2=i(" "),e.s0-=i(t),e.s0<0&&(e.s0+=1),e.s1-=i(t),e.s1<0&&(e.s1+=1),e.s2-=i(t),e.s2<0&&(e.s2+=1),i=null}function r(t,n){return n.c=t.c,n.s0=t.s0,n.s1=t.s1,n.s2=t.s2,n}function o(t,n){var e=new i(t),o=n&&n.state,s=e.next;return s.int32=function(){return 4294967296*e.next()|0},s.double=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.quick=s,o&&("object"==typeof o&&r(o,e),s.state=function(){return r(e,{})}),s}n&&n.exports?n.exports=o:e&&e.amd?e((function(){return o})):this.alea=o}(0,t,!1)})),l=a((function(t){!function(t,n,e){function i(t){var n=this,e="";n.x=0,n.y=0,n.z=0,n.w=0,n.next=function(){var t=n.x^n.x<<11;return n.x=n.y,n.y=n.z,n.z=n.w,n.w^=n.w>>>19^t^t>>>8},t===(0|t)?n.x=t:e+=t;for(var i=0;i<e.length+64;i++)n.x^=0|e.charCodeAt(i),n.next()}function r(t,n){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n}function o(t,n){var e=new i(t),o=n&&n.state,s=function(){return(e.next()>>>0)/4294967296};return s.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=e.next,s.quick=s,o&&("object"==typeof o&&r(o,e),s.state=function(){return r(e,{})}),s}n&&n.exports?n.exports=o:e&&e.amd?e((function(){return o})):this.xor128=o}(0,t,!1)})),f=a((function(t){!function(t,n,e){function i(t){var n=this,e="";n.next=function(){var t=n.x^n.x>>>2;return n.x=n.y,n.y=n.z,n.z=n.w,n.w=n.v,(n.d=n.d+362437|0)+(n.v=n.v^n.v<<4^t^t<<1)|0},n.x=0,n.y=0,n.z=0,n.w=0,n.v=0,t===(0|t)?n.x=t:e+=t;for(var i=0;i<e.length+64;i++)n.x^=0|e.charCodeAt(i),i==e.length&&(n.d=n.x<<10^n.x>>>4),n.next()}function r(t,n){return n.x=t.x,n.y=t.y,n.z=t.z,n.w=t.w,n.v=t.v,n.d=t.d,n}function o(t,n){var e=new i(t),o=n&&n.state,s=function(){return(e.next()>>>0)/4294967296};return s.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=e.next,s.quick=s,o&&("object"==typeof o&&r(o,e),s.state=function(){return r(e,{})}),s}n&&n.exports?n.exports=o:e&&e.amd?e((function(){return o})):this.xorwow=o}(0,t,!1)})),d=a((function(t){!function(t,n,e){function i(t){var n=this;n.next=function(){var t,e,i=n.x,r=n.i;return t=i[r],e=(t^=t>>>7)^t<<24,e^=(t=i[r+1&7])^t>>>10,e^=(t=i[r+3&7])^t>>>3,e^=(t=i[r+4&7])^t<<7,t=i[r+7&7],e^=(t^=t<<13)^t<<9,i[r]=e,n.i=r+1&7,e},function(t,n){var e,i=[];if(n===(0|n))i[0]=n;else for(n=""+n,e=0;e<n.length;++e)i[7&e]=i[7&e]<<15^n.charCodeAt(e)+i[e+1&7]<<13;for(;i.length<8;)i.push(0);for(e=0;e<8&&0===i[e];++e);for(8==e&&(i[7]=-1),t.x=i,t.i=0,e=256;e>0;--e)t.next()}(n,t)}function r(t,n){return n.x=t.x.slice(),n.i=t.i,n}function o(t,n){null==t&&(t=+new Date);var e=new i(t),o=n&&n.state,s=function(){return(e.next()>>>0)/4294967296};return s.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=e.next,s.quick=s,o&&(o.x&&r(o,e),s.state=function(){return r(e,{})}),s}n&&n.exports?n.exports=o:e&&e.amd?e((function(){return o})):this.xorshift7=o}(0,t,!1)})),x=a((function(t){!function(t,n,e){function i(t){var n=this;n.next=function(){var t,e,i=n.w,r=n.X,o=n.i;return n.w=i=i+1640531527|0,e=r[o+34&127],t=r[o=o+1&127],e^=e<<13,t^=t<<17,e^=e>>>15,t^=t>>>12,e=r[o]=e^t,n.i=o,e+(i^i>>>16)|0},function(t,n){var e,i,r,o,s,u=[],c=128;for(n===(0|n)?(i=n,n=null):(n+="\0",i=0,c=Math.max(c,n.length)),r=0,o=-32;o<c;++o)n&&(i^=n.charCodeAt((o+32)%n.length)),0===o&&(s=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,o>=0&&(s=s+1640531527|0,r=0==(e=u[127&o]^=i+s)?r+1:0);for(r>=128&&(u[127&(n&&n.length||0)]=-1),r=127,o=512;o>0;--o)i=u[r+34&127],e=u[r=r+1&127],i^=i<<13,e^=e<<17,i^=i>>>15,e^=e>>>12,u[r]=i^e;t.w=s,t.X=u,t.i=r}(n,t)}function r(t,n){return n.i=t.i,n.w=t.w,n.X=t.X.slice(),n}function o(t,n){null==t&&(t=+new Date);var e=new i(t),o=n&&n.state,s=function(){return(e.next()>>>0)/4294967296};return s.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=e.next,s.quick=s,o&&(o.X&&r(o,e),s.state=function(){return r(e,{})}),s}n&&n.exports?n.exports=o:e&&e.amd?e((function(){return o})):this.xor4096=o}(0,t,!1)})),p=a((function(t){!function(t,n,e){function i(t){var n=this,e="";n.next=function(){var t=n.b,e=n.c,i=n.d,r=n.a;return t=t<<25^t>>>7^e,e=e-i|0,i=i<<24^i>>>8^r,r=r-t|0,n.b=t=t<<20^t>>>12^e,n.c=e=e-i|0,n.d=i<<16^e>>>16^r,n.a=r-t|0},n.a=0,n.b=0,n.c=-1640531527,n.d=1367130551,t===Math.floor(t)?(n.a=t/4294967296|0,n.b=0|t):e+=t;for(var i=0;i<e.length+20;i++)n.b^=0|e.charCodeAt(i),n.next()}function r(t,n){return n.a=t.a,n.b=t.b,n.c=t.c,n.d=t.d,n}function o(t,n){var e=new i(t),o=n&&n.state,s=function(){return(e.next()>>>0)/4294967296};return s.double=function(){do{var t=((e.next()>>>11)+(e.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},s.int32=e.next,s.quick=s,o&&("object"==typeof o&&r(o,e),s.state=function(){return r(e,{})}),s}n&&n.exports?n.exports=o:e&&e.amd?e((function(){return o})):this.tychei=o}(0,t,!1)})),g={},v=a((function(t){!function(n,e,i){var r,o=i.pow(256,6),s=i.pow(2,52),u=2*s;function c(t,c,d){var x=[],p=l(function t(n,e){var i,r=[],o=typeof n;if(e&&"object"==o)for(i in n)try{r.push(t(n[i],e-1))}catch(t){}return r.length?r:"string"==o?n:n+"\0"}((c=1==c?{entropy:!0}:c||{}).entropy?[t,f(e)]:null==t?function(){try{var t;return r&&(t=r.randomBytes)?t=t(256):(t=new Uint8Array(256),(n.crypto||n.msCrypto).getRandomValues(t)),f(t)}catch(t){var i=n.navigator,o=i&&i.plugins;return[+new Date,n,o,n.screen,f(e)]}}():t,3),x),g=new a(x),v=function(){for(var t=g.g(6),n=o,e=0;t<s;)t=256*(t+e),n*=256,e=g.g(1);for(;t>=u;)t/=2,n/=2,e>>>=1;return(t+e)/n};return v.int32=function(){return 0|g.g(4)},v.quick=function(){return g.g(4)/4294967296},v.double=v,l(f(g.S),e),(c.pass||d||function(t,n,e,r){return r&&(r.S&&h(r,g),t.state=function(){return h(g,{})}),e?(i.random=t,n):t})(v,p,"global"in c?c.global:this==i,c.state)}function a(t){var n,e=t.length,i=this,r=0,o=i.i=i.j=0,s=i.S=[];for(e||(t=[e++]);r<256;)s[r]=r++;for(r=0;r<256;r++)s[r]=s[o=255&o+t[r%e]+(n=s[r])],s[o]=n;(i.g=function(t){for(var n,e=0,r=i.i,o=i.j,s=i.S;t--;)n=s[r=255&r+1],e=256*e+s[255&(s[r]=s[o=255&o+n])+(s[o]=n)];return i.i=r,i.j=o,e})(256)}function h(t,n){return n.i=t.i,n.j=t.j,n.S=t.S.slice(),n}function l(t,n){for(var e,i=t+"",r=0;r<i.length;)n[255&r]=255&(e^=19*n[255&r])+i.charCodeAt(r++);return f(n)}function f(t){return String.fromCharCode.apply(0,t)}if(l(i.random(),e),t.exports){t.exports=c;try{r=g}catch(t){}}else i.seedrandom=c}("undefined"!=typeof self?self:c,[],Math)}));v.alea=h,v.xor128=l,v.xorwow=f,v.xorshift7=d,v.xor4096=x,v.tychei=p;let b=v();function w(t,n,e){const i=Array.isArray(arguments[0]);if(i){const t=arguments[0];return t[w(0,t.length-1,!0)]}{const t=arguments[0],n=arguments[1],e=arguments[2]||!1,i=b()*(n-t)+t;return e?Math.round(i):i}}function y(t,n,e,i=.5){const r=w(t,n),o=w(0,1)*i;return r*(1-o)+e*o}class m{constructor(t,n=10,e=4,i=0){this.bounds=t,this.maxObjects=n,this.maxLevels=e,this.level=i,this.objects=[],this.nodes=[]}split(){const t=this.level+1,n=this.bounds.width/2,e=this.bounds.height/2,i=this.bounds.x,r=this.bounds.y;this.nodes[0]=new m({x:i+n,y:r,width:n,height:e},this.maxObjects,this.maxLevels,t),this.nodes[1]=new m({x:i,y:r,width:n,height:e},this.maxObjects,this.maxLevels,t),this.nodes[2]=new m({x:i,y:r+e,width:n,height:e},this.maxObjects,this.maxLevels,t),this.nodes[3]=new m({x:i+n,y:r+e,width:n,height:e},this.maxObjects,this.maxLevels,t)}getIndex(t){const n=this.bounds,e=[],i=n.x+n.width/2,r=n.y+n.height/2,o=t.y<r,s=t.x<i,u=t.x+t.width>i,c=t.y+t.height>r;return o&&u&&e.push(0),s&&o&&e.push(1),s&&c&&e.push(2),u&&c&&e.push(3),e}insert(t){let n;if(this.nodes.length){n=this.getIndex(t);for(let e=0;e<n.length;e++)this.nodes[n[e]].insert(t)}else if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels){this.nodes.length||this.split();for(let t=0;t<this.objects.length;t++){n=this.getIndex(this.objects[t]);for(let e=0;e<n.length;e++)this.nodes[n[e]].insert(this.objects[t])}this.objects=[]}}retrieve(t){const n=this.getIndex(t);let e=this.objects;if(this.nodes.length)for(let i=0;i<n.length;i++)e=e.concat(this.nodes[n[i]].retrieve(t));return e=e.filter((t,n)=>e.indexOf(t)>=n),e}clear(){this.objects=[];for(let t=0;t<this.nodes.length;t++)this.nodes.length&&this.nodes[t].clear();this.nodes=[]}}const j=function(t,n){return n.map(n=>{switch(n.variable=`--${t}-${n.name}`,n.type){case"number":n.value=t=>parseInt(t);break;case"string":n.value=t=>t.toString().trim();break;case"boolean":case"object":n.value=t=>JSON.parse(t)}}),Object.defineProperties({},{propsMap:{value:n},values:{get:function(){const t=[];return this.propsMap.forEach(n=>t.push(n.value)),t}},variableStrings:{get:function(){const t=[];return this.propsMap.forEach(n=>t.push(n.variable)),t}}})}("quadtree",[{name:"points",type:"number",default:100},{name:"gaps",type:"number",default:5},{name:"maxObjects",type:"number",default:10},{name:"maxLevels",type:"number",default:4}]);function S(t){const n=[];return function t(e){0===e.nodes.length?n.push(e):e.nodes.forEach(n=>t(n))}(t),n}const z=new Map;let k=class{static get inputProperties(){return j.variableStrings}static get childInputProperties(){return[]}intrinsicSizes(n,e,i){return t(this,void 0,void 0,(function*(){const t=yield Promise.all(n.map(t=>t.intrinsicSizes())),i=t.reduce((t,n)=>t+n.maxContentSize,0)+e.inline;return{minContentSize:t.reduce((t,n)=>t+n.minContentSize,0)+e.inline,maxContentSize:i}}))}layout(n,e,i,r,o){return t(this,void 0,void 0,(function*(){const t={};j.propsMap.forEach(n=>t[n.name]=n.value(r.get(n.variable))||n.default),console.log(t);const o=i.fixedInlineSize-e.inline,s=i.fixedBlockSize?i.fixedBlockSize-e.block:o,u=function(t){let n=0;if(Object.values(t).forEach(t=>n+=function(t){let n=0;if(0==t.length)return n;for(let e=0;e<t.length;e++){n=(n<<5)-n+t.charCodeAt(e),n&=n}return n}(t.toString())),z.has(n))return console.log(z.get(n),"cache"),z.get(n);{const e={x:w(0,t.width),y:w(0,t.height)},i=[...Array(t.points)].map(()=>({x:y(0,t.width,e.x,1),y:y(0,t.height,e.y,1),width:1,height:1})),r=new m({x:0,y:0,width:t.width,height:t.height},t.maxObjects,t.maxLevels);return i.forEach(t=>r.insert(t)),z.set(n,r),console.log(r,"first"),r}}({width:o,height:s,maxObjects:t.maxObjects,maxLevels:t.maxLevels,points:t.points}),c=Math.pow(2,t.maxLevels),a=o/c,h=s/c,l={width:o,height:s,cols:c,rows:c,areas:S(u).map(({bounds:n})=>Object.assign({x:n.x+t.gaps,y:n.y+t.gaps,width:n.width-t.gaps,height:n.height-t.gaps},function(t,n,e){return{col:{start:t.x/n,end:(t.x+t.width)/n},row:{start:t.y/e,end:(t.y+t.height)/e}}}(n,a,h)))},f=yield Promise.all(n.map((t,n)=>t.layoutNextFragment({fixedInlineSize:l.areas[n].width,fixedBlockSize:l.areas[n].height})));for(let t of f){const n=f.indexOf(t),e=l.areas[n];t.inlineOffset=e.x,t.blockOffset=e.y}return{autoBlockSize:0,childFragments:f}}))}};var O;k.LayoutOptions={childDisplay:n.normal,sizing:e.blockLike},k=function(t,n,e,i){var r,o=arguments.length,s=o<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,e):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,n,e,i);else for(var u=t.length-1;u>=0;u--)(r=t[u])&&(s=(o<3?r(s):o>3?r(n,e,s):r(n,e))||s);return o>3&&s&&Object.defineProperty(n,e,s),s}([(O="quadtree",function(t){t.prototype.layout&&t.prototype.intrinsicSizes||(t=u),registerLayout(O,t)})],k);export{k as QuadtreeLayout};
